<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.3.1. Create G-OnRamp Production Image &#8212; G-OnRamp 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Tutorials of G-OnRamp" href="../tutorials.html" />
    <link rel="prev" title="1.2.1. Create G-OnRamp Virtual Machine Image" href="create_virtual_image.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="create-g-onramp-production-image">
<h1>1.3.1. Create G-OnRamp Production Image<a class="headerlink" href="#create-g-onramp-production-image" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>1.3.1.1. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Download and install Virtual Box =&gt; <a class="reference external" href="https://www.virtualbox.org">https://www.virtualbox.org</a></li>
<li>Download Ubuntu Server 16.04.1 LTS =&gt; <a class="reference external" href="https://www.ubuntu.com/download/server">https://www.ubuntu.com/download/server</a></li>
</ol>
</div>
<div class="section" id="step-by-step-instruction">
<h2>1.3.1.2. Step by step instruction<a class="headerlink" href="#step-by-step-instruction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-ubuntu-server-to-the-virtualbox">
<h3>1.3.1.2.1. Install Ubuntu server to the VirtualBox<a class="headerlink" href="#install-ubuntu-server-to-the-virtualbox" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="http://tecadmin.net/install-ubuntu-on-virtualbox/">How to Install Ubuntu on VirtualBox</a></p>
<p>Additional settings when installing the Ubuntu</p>
<ul class="simple">
<li>Hostname: ubuntus</li>
<li>Full name: galaxyadmin</li>
<li>User name: galaxyadmin</li>
<li>password: 1234</li>
<li>Use entire disk and set up LVM</li>
<li>No proxy configured</li>
<li>Install security updates automatically</li>
<li>Install LAMP server, PostgreSQL database, OpenSSH server</li>
<li>Create new GRUB boot loader</li>
</ul>
</div>
<div class="section" id="initial-ubuntu-setup">
<h3>1.3.1.2.2. Initial Ubuntu setup<a class="headerlink" href="#initial-ubuntu-setup" title="Permalink to this headline">¶</a></h3>
<p>Start the Ubuntu and login in to update the system.</p>
<p>Update packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ apt-get --with-new-pkgs upgrade
</pre></div>
</div>
<p>Install dependencies:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo apt-get install build-essential
$ sudo apt-get install cmake
$ sudo apt-get install zlib1g-dev
$ reboot
</pre></div>
</div>
</div>
<div class="section" id="set-up-internet-host-only-adapter-used-to-connect-guest-vm-from-host-by-ssh">
<h3>1.3.1.2.3. Set up internet host-only adapter (used to connect guest VM from host by ssh)<a class="headerlink" href="#set-up-internet-host-only-adapter-used-to-connect-guest-vm-from-host-by-ssh" title="Permalink to this headline">¶</a></h3>
<p>Shutdown the virtual machine and add vboxnet0 to Adapter 2 as Host-only Adapter. Then restart the virtual machine.</p>
<a class="reference internal image-reference" href="../_images/network.png"><img alt="add vboxnet0 to Adapter 2" class="align-center" src="../_images/network.png" style="width: 500px;" /></a>
<p>On the host, type command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ifconfig
</pre></div>
</div>
<p>Find the vboxnet0 ip:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vboxnet0</span><span class="p">:</span> <span class="n">flags</span><span class="o">=</span><span class="mi">8943</span><span class="o">&lt;</span><span class="n">UP</span><span class="p">,</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">RUNNING</span><span class="p">,</span><span class="n">PROMISC</span><span class="p">,</span><span class="n">SIMPLEX</span><span class="p">,</span><span class="n">MULTICAST</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span>
<span class="n">ether</span> <span class="mi">0</span><span class="n">a</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">inet</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.1</span> <span class="n">netmask</span> <span class="mh">0xffffff00</span> <span class="n">broadcast</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.255</span>
</pre></div>
</div>
<p>On the Ubuntu guest, list interfaces by typing the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ip addr
</pre></div>
</div>
<p>You should see three interfaces like lo, enp0s3, enp0s8. We will use the third.</p>
<p>Edit the interfaces file by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd /etc/network/interfaces
</pre></div>
</div>
<p>Add following enp0s8 configuration to the file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">enp0s8</span>
<span class="n">iface</span> <span class="n">enp0s8</span> <span class="n">inet</span> <span class="n">static</span>
<span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
<span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
</pre></div>
</div>
<p>Then activate the interface:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo ifup enp0s8
</pre></div>
</div>
<p>Check if enp0s8 got correct address. You should see your ip by typing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ip addr show enp0s8
 ...
inet 192.168.56.11/24 brd 192.168.56.255 scope global secondary enp0s8
</pre></div>
</div>
<p>If not correct, you may run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo ifdown enp0s8
$ sudo ifup enp0s8
$ reboot
</pre></div>
</div>
<p>Now you can access to Ubuntu guest through host by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ssh galaxyadmin@192.168.56.11
</pre></div>
</div>
</div>
<div class="section" id="install-galaxy">
<h3>1.3.1.2.4. Install Galaxy<a class="headerlink" href="#install-galaxy" title="Permalink to this headline">¶</a></h3>
<p>Running as an existing user will cause problems down the line when you want to grant or restrict access to data.</p>
<p>Create a NON-ROOT user called galaxy:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo adduser galaxy
password: 2016
Add galaxy to sudo
$ usermod -aG sudo galaxy
Then login with galaxy
$ su - galaxy
</pre></div>
</div>
<p>Make sure Galaxy is using a clean Python interpreter. Conflicts in $PYTHONPATH or the interpreter&#8217;s site-packages/ directory could cause problems. Galaxy manages its own dependencies for the framework, so you do not need to worry about these.</p>
<p>The easiest way to do this is with a virtualenv:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install python-pip
$ pip install --upgrade pip
$ sudo pip install virtualenv
$ virtualenv gonramp
$ source gonramp/bin/activate
</pre></div>
</div>
<p>Galaxy requires a few things to run: a virtualenv, configuration files and dependent python modules. Starting the server at the first time will set these thing up.</p>
<p>Download Galaxy 17.01 and rename galaxy folder:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone -b release_17.01 https://github.com/galaxyproject/galaxy.git
$ mv galaxy/ galaxy-dist
</pre></div>
</div>
<p>Basic configure Galaxy (galaxy.ini):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">server</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="c1"># The address on which to listen.  By default, only listen to localhost (Galaxy</span>
<span class="c1"># will not be accessible over the network).  Use &#39;0.0.0.0&#39; to listen on all</span>
<span class="c1"># available network interfaces.</span>
<span class="n">host</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
<span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">use_interactive</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># filter-with = gzip</span>
<span class="n">cleanup_job</span> <span class="o">=</span> <span class="n">onsuccess</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-postgresql-database">
<h3>1.3.1.2.5. Set up PostgreSQL database<a class="headerlink" href="#set-up-postgresql-database" title="Permalink to this headline">¶</a></h3>
<p>Install PostgreSQL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install postgresql postgresql-contrib
</pre></div>
</div>
<p>Once installed, create a new database user and new database which the new user is the owner of. No further setup is required, since Galaxy manages its own schema. If you are using a UNIX socket to connect the application to the database (this is the standard case if Galaxy and the database are on the same system), you&#8217;ll want to name the database user the same as the system user under which you run the Galaxy process.</p>
<p>Create a database and a new user for the database:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo -u postgres createuser --superuser galaxy
$ sudo -u galaxy createdb galaxy
$ psql -U galaxy
galaxy=# \password
Enter new password: 1234
</pre></div>
</div>
<p>In galaxy.ini, set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">database_connection</span> <span class="o">=</span> <span class="n">postgresql</span><span class="p">:</span><span class="o">//</span><span class="n">galaxy</span><span class="p">:</span><span class="mi">1234</span><span class="nd">@localhost</span><span class="o">/</span><span class="n">galaxy</span>
</pre></div>
</div>
<p>Run Galaxy:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd galaxy
$ sh run.sh
</pre></div>
</div>
</div>
<div class="section" id="set-up-proxy-nginx">
<h3>1.3.1.2.6. Set up proxy nginx<a class="headerlink" href="#set-up-proxy-nginx" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04#step-3-check-your-web-server">reference of how to install nginx</a></p>
<div class="section" id="install-nginx">
<h4>1.3.1.2.6.1. Install nginx<a class="headerlink" href="#install-nginx" title="Permalink to this headline">¶</a></h4>
<p>Install nginx from pre-build package:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo systemctl stop apache2.service
$ sudo apt-get update
$ sudo apt-get install nginx
$ sudo apt-get install nginx-extras
</pre></div>
</div>
</div>
<div class="section" id="add-galaxy-server-block">
<h4>1.3.1.2.6.2. Add galaxy server block<a class="headerlink" href="#add-galaxy-server-block" title="Permalink to this headline">¶</a></h4>
<p>add server block:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd /etc/nginx/sites-available/
$ sudo vim galaxy
</pre></div>
</div>
<p>add following server block to galaxy file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>server {
  listen 80;
  root /var/www/html;
  # maximum file upload size
  client_max_body_size 10G;

  # pass most requests to the proxied Galaxy application
  location /gonramp {
      proxy_pass        http://192.168.56.11:8080;
      proxy_set_header    X-Forwarded-Host $host;
      proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # directly serve static content in nginx
  location /gonramp/static {
      alias /home/galaxy/galaxy-dist/static;
      expires 24h;
  }
  location /gonramp/static/style {
      alias /home/galaxy/galaxy-dist/static/style/blue;
      expires 24h;
  }
  location /gonramp/static/scripts {
      alias /home/galaxy/galaxy-dist/static/scripts;
      expires 24h;
  }
  location /gonramp/favicon.ico {
      alias /home/galaxy/galaxy-dist/static/favicon.ico;
      expires 24h;
  }
  location /gonramp/robots.txt {
      alias /home/galaxy/galaxy-dist/static/robots.txt;
      expires 24h;
  }
}
</pre></div>
</div>
<p>enable galaxy server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd /etc/nginx/sites-enabled/
$ sudo ln -s /etc/nginx/sites-available/galaxy /etc/nginx/sites-enabled/galaxy
</pre></div>
</div>
<p>Make sure that you either comment out or modify line containing default configuration for enabled sites. in /etc/nginx/nginx.conf, include /etc/nginx/sites-enabled/:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd /etc/nginx/site-enabled
$ rm default
$ sudo service nginx restart
</pre></div>
</div>
<p>Galaxy application needs to be aware that it is running with a prefix (for generating URLs in dynamic pages). This is accomplished by configuring a Paste proxy-prefix filter in the [app:main] section of config/galaxy.ini and restarting Galaxy:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">server</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
  <span class="n">host</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
<span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">proxy</span><span class="o">-</span><span class="n">prefix</span><span class="p">]</span>
  <span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">PasteDeploy</span><span class="c1">#prefix</span>
  <span class="n">prefix</span> <span class="o">=</span> <span class="o">/</span><span class="n">gonramp</span>
<span class="p">[</span><span class="n">app</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
  <span class="nb">filter</span><span class="o">-</span><span class="k">with</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">-</span><span class="n">prefix</span>
  <span class="n">cookie_path</span> <span class="o">=</span> <span class="o">/</span><span class="n">gonramp</span>
</pre></div>
</div>
</div>
<div class="section" id="compression-and-caching">
<h4>1.3.1.2.6.3. Compression and caching<a class="headerlink" href="#compression-and-caching" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://galaxyproject.org/admin/config/nginxProxy/">nginx_ref</a></p>
<p>All of Galaxy&#8217;s static content can be cached on the client side, and everything (including dynamic content) can be compressed on the fly. This will decrease download and page load times for your clients, as well as decrease server load and bandwidth usage. To enable, you&#8217;ll need nginx gzip support (which is standard unless compiled with &#8211;without-http_gzip_module), and the following in your nginx.conf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!highlight nginx</span>
<span class="n">http</span> <span class="p">{</span>
      <span class="n">gzip</span> <span class="n">on</span><span class="p">;</span>
      <span class="n">gzip_disable</span> <span class="s2">&quot;msie6&quot;</span><span class="p">;</span>

      <span class="n">gzip_vary</span> <span class="n">on</span><span class="p">;</span>
      <span class="n">gzip_proxied</span> <span class="nb">any</span><span class="p">;</span>
      <span class="n">gzip_comp_level</span> <span class="mi">4</span><span class="p">;</span>
      <span class="n">gzip_buffers</span> <span class="mi">16</span> <span class="mi">8</span><span class="n">k</span><span class="p">;</span>
      <span class="n">gzip_http_version</span> <span class="mf">1.1</span><span class="p">;</span>
      <span class="n">gzip_types</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span> <span class="n">text</span><span class="o">/</span><span class="n">css</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span> <span class="n">application</span><span class="o">/</span><span class="n">javascript</span> <span class="n">text</span><span class="o">/</span><span class="n">xml</span> <span class="n">application</span><span class="o">/</span><span class="n">xml</span> <span class="n">application</span><span class="o">/</span><span class="n">xml</span><span class="o">+</span><span class="n">rss</span> <span class="n">text</span><span class="o">/</span><span class="n">javascript</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For caching, you&#8217;ll need to add an expires directive to the location /static { } blocks (already added, see server block)</p>
</div>
<div class="section" id="sending-files-using-nginx">
<h4>1.3.1.2.6.4. Sending files using nginx<a class="headerlink" href="#sending-files-using-nginx" title="Permalink to this headline">¶</a></h4>
<p>Add following to galaxy server block:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="p">{</span>
      <span class="n">location</span> <span class="n">gonramp</span><span class="o">/</span><span class="n">_x_accel_redirect</span><span class="o">/</span> <span class="p">{</span>
          <span class="n">internal</span><span class="p">;</span>
          <span class="n">alias</span> <span class="o">/</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>And the following to the [app:main] section of config/galaxy.ini:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nginx_x_accel_redirect_base</span> <span class="o">=</span> <span class="o">/</span><span class="n">_x_accel_redirect</span>
</pre></div>
</div>
</div>
<div class="section" id="receiving-files-using-nginx">
<h4>1.3.1.2.6.5. Receiving files using nginx<a class="headerlink" href="#receiving-files-using-nginx" title="Permalink to this headline">¶</a></h4>
<p>To enable it, you must first download, compile and install nginx_upload_module. This means recompiling nginx.
TODO: need to install nginx from the source and recompile</p>
</div>
</div>
<div class="section" id="rotate-log-files">
<h3>1.3.1.2.7. Rotate log files<a class="headerlink" href="#rotate-log-files" title="Permalink to this headline">¶</a></h3>
<p>To use logrotate to rotate Galaxy log files, add a new file named &#8220;galaxy&#8221; to /etc/logrotate.d/ directory with something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">PATH_TO_GALAXY_LOG_FILES</span> <span class="p">{</span>
  <span class="n">weekly</span>
  <span class="n">rotate</span> <span class="mi">8</span>
  <span class="n">copytruncate</span>
  <span class="n">compress</span>
  <span class="n">missingok</span>
  <span class="n">notifempty</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ftp-server">
<h3>1.3.1.2.8. FTP server<a class="headerlink" href="#ftp-server" title="Permalink to this headline">¶</a></h3>
<p><cite>Reference Enabling upload to Galaxy via FTP &lt;https://galaxyproject.org/admin/config/upload-via-ftp/&gt;_</cite></p>
<p>in the config file, galaxy.ini, set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ftp_upload_dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">galaxy</span><span class="o">/</span><span class="n">galaxy</span><span class="o">-</span><span class="n">dist</span><span class="o">/</span><span class="n">database</span><span class="o">/</span><span class="n">ftp</span><span class="o">/</span>
<span class="n">ftp_upload_site</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
</pre></div>
</div>
<div class="section" id="set-up-ftp-server">
<h4>1.3.1.2.8.1. set up FTP server<a class="headerlink" href="#set-up-ftp-server" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://kyup.com/tutorials/install-setup-ftp-server-proftpd/">FTP server</a></p>
<p>Install ProFTPD:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo apt-get install proftpd
$ sudo apt-get install proftpd-mod-pgsql
$ sudo nano /etc/proftpd/proftpd.conf
</pre></div>
</div>
<p>Configure /etc/proftpd/proftpd.conf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Includes DSO modules</span>
<span class="n">Include</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">proftpd</span><span class="o">/</span><span class="n">modules</span><span class="o">.</span><span class="n">conf</span>

<span class="c1"># Basics, some site-specific</span>
<span class="n">ServerName</span>                      <span class="s2">&quot;Public Galaxy FTP&quot;</span>
<span class="n">ServerType</span>                      <span class="n">standalone</span>
<span class="n">DefaultServer</span>                   <span class="n">on</span>
<span class="n">Port</span>                            <span class="mi">21</span>
<span class="n">Umask</span>                           <span class="mi">022</span>
<span class="n">SyslogFacility</span>                 <span class="n">DAEMON</span>
<span class="n">SyslogLevel</span>                    <span class="n">debug</span>
<span class="n">MaxInstances</span>                    <span class="mi">30</span>
<span class="n">User</span>                            <span class="n">galaxy</span>
<span class="n">Group</span>                           <span class="n">galaxy</span>

<span class="c1"># Passive port range for the firewall</span>
<span class="n">PassivePorts</span>                    <span class="mi">30000</span> <span class="mi">40000</span>

<span class="c1"># Cause every FTP user to be &quot;jailed&quot; (chrooted) into their home directory</span>
<span class="n">DefaultRoot</span>                     <span class="o">~</span>

<span class="c1"># Automatically create home directory if it doesn&#39;t exist</span>
<span class="n">CreateHome</span>                      <span class="n">on</span> <span class="n">dirmode</span> <span class="mi">700</span>

<span class="c1"># Allow users to overwrite their files</span>
<span class="n">AllowOverwrite</span>                  <span class="n">on</span>

<span class="c1"># Allow users to resume interrupted uploads</span>
<span class="n">AllowStoreRestart</span>               <span class="n">on</span>

<span class="c1"># Bar use of SITE CHMOD</span>
<span class="o">&lt;</span><span class="n">Limit</span> <span class="n">SITE_CHMOD</span><span class="o">&gt;</span>
  <span class="n">DenyAll</span>
<span class="o">&lt;/</span><span class="n">Limit</span><span class="o">&gt;</span>

<span class="c1"># Bar use of RETR (download) since this is not a public file drop</span>
<span class="o">&lt;</span><span class="n">Limit</span> <span class="n">RETR</span><span class="o">&gt;</span>
  <span class="n">DenyAll</span>
<span class="o">&lt;/</span><span class="n">Limit</span><span class="o">&gt;</span>

<span class="c1"># Do not authenticate against real (system) users</span>
<span class="n">AuthPAM</span>                         <span class="n">off</span>

<span class="c1"># By default, Galaxy stores passwords using PBKDF2.</span>
<span class="c1"># Configuration that handles PBKDF2 encryption</span>
<span class="n">SQLPasswordEngine</span>               <span class="n">on</span>
<span class="n">SQLPasswordEncoding</span>             <span class="n">base64</span>
<span class="n">SQLPasswordPBKDF2</span>               <span class="n">SHA256</span> <span class="mi">10000</span> <span class="mi">24</span>
<span class="n">SQLPasswordUserSalt</span>             <span class="n">sql</span><span class="p">:</span><span class="o">/</span><span class="n">GetUserSalt</span>

<span class="c1"># Set up mod_sql to authenticate against the Galaxy database</span>
<span class="n">SQLEngine</span>                       <span class="n">on</span>
<span class="n">SQLBackend</span>                      <span class="n">postgres</span>
<span class="n">SQLConnectInfo</span>                  <span class="n">galaxy</span><span class="o">@/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">postgresql</span> <span class="n">galaxy</span> <span class="mi">1234</span>
<span class="n">SQLAuthTypes</span>                    <span class="n">PBKDF2</span>
<span class="n">SQLAuthenticate</span>                 <span class="n">users</span>

<span class="c1"># An empty directory in case chroot fails</span>
<span class="n">SQLDefaultHomedir</span>               <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">proftpd</span>

<span class="c1"># Define a custom query for lookup that returns a passwd-like entry. Replace 1001s with the UID and GID of the user running the Galaxy server (to find out: $ id galaxy)</span>
<span class="n">SQLUserInfo</span>                     <span class="n">custom</span><span class="p">:</span><span class="o">/</span><span class="n">LookupGalaxyUser</span>
<span class="n">SQLNamedQuery</span>                   <span class="n">LookupGalaxyUser</span> <span class="n">SELECT</span> <span class="s2">&quot;email, (CASE WHEN substring(password from 1 for 6) = &#39;PBKDF2&#39; THEN substring(password from 38 for 69) ELSE password END) AS password2,1001,1001,&#39;/home/galaxy/galaxy-dist/database/ftp/%U&#39;,&#39;/bin/bash&#39; FROM galaxy_user WHERE email=&#39;%U&#39;&quot;</span>
<span class="n">SQLNamedQuery</span>                   <span class="n">GetUserSalt</span> <span class="n">SELECT</span> <span class="s2">&quot;(CASE WHEN SUBSTRING (password from 1 for 6) = &#39;PBKDF2&#39; THEN SUBSTRING (password from 21 for 16) END) AS salt FROM galaxy_user WHERE email=&#39;%U&#39;&quot;</span>
</pre></div>
</div>
<p>Configure /etc/proftpd/modules.conf, add:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">LoadModule</span> <span class="n">mod_sql</span><span class="o">.</span><span class="n">c</span>
<span class="n">LoadModule</span> <span class="n">mod_sql_passwd</span><span class="o">.</span><span class="n">c</span>
<span class="n">LoadModule</span> <span class="n">mod_sql_postgres</span><span class="o">.</span><span class="n">c</span>
<span class="n">LoadModule</span> <span class="n">mod_sftp_sql</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>When we are ready with the configuration we can start up the ProFTPD server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo /etc/init.d/proftpd start
or $ sudo service proftpd restart
</pre></div>
</div>
</div>
</div>
<div class="section" id="scaling-and-load-balancing">
<h3>1.3.1.2.9. Scaling and Load Balancing<a class="headerlink" href="#scaling-and-load-balancing" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://galaxyproject.org/admin/config/performance/scaling/">reference1</a></p>
<p><a class="reference external" href="https://galaxyproject.org/events/bio-it-world2014/w14/">reference2</a></p>
<p>Enable multiple cores in the virtual environment</p>
<ol class="arabic simple">
<li>Stop the VM and go to Settings -&gt; System -&gt; Process</li>
<li>Change the processors number. I changed to 4.</li>
<li>Check &#8220;Enable PAE/NX&#8221;, as &#8220;Some operating systems (such as Ubuntu Server) require PAE support from the CPU and cannot be run in a virtual machine without it.&#8221; ( <a class="reference external" href="https://www.virtualbox.org/manual/ch03.html">reference</a>)</li>
</ol>
<div class="section" id="set-up-uwsgi">
<h4>1.3.1.2.9.1. Set up uWSGI<a class="headerlink" href="#set-up-uwsgi" title="Permalink to this headline">¶</a></h4>
<p>In galaxy.ini, define one or more [server:...] sections:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Two are shown, you should create as many as are suitable for your usage and hardware.</span>
<span class="p">[</span><span class="n">server</span><span class="p">:</span><span class="n">web0</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">Paste</span><span class="c1">#http</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span>
<span class="n">host</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
<span class="n">use_threadpool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">threadpool_workers</span> <span class="o">=</span> <span class="mi">7</span>

<span class="p">[</span><span class="n">server</span><span class="p">:</span><span class="n">web1</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">Paste</span><span class="c1">#http</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">8081</span>
<span class="n">host</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
<span class="n">use_threadpool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">threadpool_workers</span> <span class="o">=</span> <span class="mi">7</span>
</pre></div>
</div>
<p>In galaxy.ini, define a [uwsgi] section:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">uwsgi</span><span class="p">]</span>
<span class="n">processes</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">stats</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span><span class="p">:</span><span class="mi">9191</span>
<span class="n">socket</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span><span class="p">:</span><span class="mi">4001</span>
<span class="n">pythonpath</span> <span class="o">=</span> <span class="n">lib</span>
<span class="n">threads</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">logto</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">galaxy</span><span class="o">/</span><span class="n">gonramp</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">uwsgi</span><span class="o">.</span><span class="n">log</span> <span class="c1">#anywhere you like</span>
<span class="n">master</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Port numbers for stats and socket can be adjusted as desired. Moreover, in the [app:main] section, you must set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">static_enabled</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">track_jobs_in_database</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Install wusgi:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># use pip install in the virtual environment
$ source gonramp/bin/activate
$ pip install uwsgi
</pre></div>
</div>
<p>The web processes can then be started under uWSGI using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd /path/to/galaxy-dist
$ PYTHONPATH=eggs/PasteDeploy-1.5.0-py2.7.egg uwsgi --ini-paste config/galaxy.ini
#Once started, a proxy server (typically Apache or nginx) must be configured to proxy requests to uWSGI (using uWSGI&#39;s native protocol). Configuration details for these can be found in Proxy section.
</pre></div>
</div>
</div>
<div class="section" id="job-handler-s">
<h4>1.3.1.2.9.2. Job Handler(s)<a class="headerlink" href="#job-handler-s" title="Permalink to this headline">¶</a></h4>
<p>In galaxy.ini, define one or more additional [server:...] sections:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">server</span><span class="p">:</span><span class="n">handler0</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">Paste</span><span class="c1">#http</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">8090</span>
<span class="n">host</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
<span class="n">use_threadpool</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">threadpool_workers</span> <span class="o">=</span> <span class="mi">5</span>

<span class="p">[</span><span class="n">server</span><span class="p">:</span><span class="n">handler1</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">Paste</span><span class="c1">#http</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">8091</span>
<span class="n">host</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">56.11</span>
<span class="n">use_threadpool</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">threadpool_workers</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-job-conf-xml">
<h4>1.3.1.2.9.3. Configure job_conf.xml<a class="headerlink" href="#configure-job-conf-xml" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://galaxyproject.org/admin/config/jobs/">Configure job reference</a></p>
<p>Uncomment in galaxy.ini:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">job_config_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">/</span><span class="n">job_conf</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>Configure galaxy-dist/conf/job_conf.xml:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!-- A sample job config that explicitly configures job running the way it is configured by default (if there is no explicit config). --&gt;
&lt;job_conf&gt;
  &lt;plugins&gt;
      &lt;plugin id=&quot;local&quot; type=&quot;runner&quot; load=&quot;galaxy.jobs.runners.local:LocalJobRunner&quot; workers=&quot;4&quot;/&gt;
  &lt;/plugins&gt;
  &lt;handlers default=&quot;handlers&quot;&gt;
      &lt;handler id=&quot;handler0&quot; tags=&quot;handlers&quot;/&gt;
      &lt;handler id=&quot;handler1&quot; tags=&quot;handlers&quot;/&gt;
  &lt;/handlers&gt;
  &lt;destinations&gt;
      &lt;destination id=&quot;local&quot; runner=&quot;local&quot;/&gt;
  &lt;/destinations&gt;
&lt;/job_conf&gt;
</pre></div>
</div>
</div>
<div class="section" id="start-and-stop-with-supervisord">
<h4>1.3.1.2.9.4. Start and Stop with supervisord<a class="headerlink" href="#start-and-stop-with-supervisord" title="Permalink to this headline">¶</a></h4>
<p>Since you need to run multiple processes, the typical run.sh method for starting and stopping Galaxy won&#8217;t work. The current recommended way to manage these multiple processes is with Supervisord.</p>
<p>Install supervisor in virtualenv:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pip install supervisor
</pre></div>
</div>
<p>Creating a Configuration File:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>echo_supervisord_conf &gt; /etc/supervisord.conf
# Configure
$ vim /etc/supervisord.conf
# add program galaxy_uwsgi, handler and group section

[program:galaxy_uwsgi]
command = /home/galaxy/gonramp/bin/uwsgi --virtualenv /home/galaxy/galaxy-dist/.venv --ini-paste /home/galaxy/galaxy-dist/config/galaxy.ini
directory = /home/galaxy/galaxy-dist
umask = 022
autostart = true
autorestart = true
startsecs = 20
user = galaxy
environment = PATH=/home/galaxy/galaxy-dist/.venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin, PYTHONHOME=/home/galaxy/galaxy-dist/.venv
numprocs = 1
stopsignal = INT
startretries = 15

[program:handler]
command = /home/galaxy/galaxy-dist/.venv/bin/python ./lib/galaxy/main.py -c ./config/galaxy.ini --server-name=handler%(process_num)s --log-file=/home/galaxy/galaxy-dist/handler%(process_num)s.log
directory = /home/galaxy/galaxy-dist
process_name = handler%(process_num)s
numprocs = 2
unmask = 022
autostart = true
autorestart = true
startsecs = 20
user = galaxy
environment = PYTHONHOME=/home/galaxy/galaxy-dist/.venv

[group:galaxy]
programs = handler, galaxy_uwsgi
</pre></div>
</div>
<p>Start the program:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ supervisorctl start galaxy:*
# Check status
$ supervisorctl status
# Log file
$ tail -f /tmp/supervisord.log
</pre></div>
</div>
</div>
<div class="section" id="proxy-uwsgi-with-nginx">
<h4>1.3.1.2.9.5. Proxy uWSGI with nginx<a class="headerlink" href="#proxy-uwsgi-with-nginx" title="Permalink to this headline">¶</a></h4>
<p>Add server block below in /etc/nginx/nginx.conf and comment out #include /etc/nginx/sites-enabled/</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>server {
  listen 80;
  root /var/www/html;
  # maximum file upload size
  client_max_body_size 10G;
  uwsgi_read_timeout 180;
  location /gonramp {
      include uwsgi_params;
      uwsgi_pass 192.168.56.11:4001;
      uwsgi_param UWSGI_SCHEME $scheme;
  }
  # directly serve static content in nginx
  location /gonramp/static {
      alias /home/galaxy/galaxy-dist/static;
      expires 24h;
  }
  location /gonramp/static/style {
      alias /home/galaxy/galaxy-dist/static/style/blue;
      expires 24h;
  }
  location /gonramp/static/scripts {
      alias /home/galaxy/galaxy-dist/static/scripts;
      expires 24h;
  }
  location /gonramp/favicon.ico {
      alias /home/galaxy/galaxy-dist/static/favicon.ico;
      expires 24h;
  }
  location /gonramp/robots.txt {
      alias /home/galaxy/galaxy-dist/static/robots.txt;
      expires 24h;
  }
}
</pre></div>
</div>
<p>Restart nginx:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo service nginx restart
</pre></div>
</div>
</div>
<div class="section" id="access-to-gonramp">
<h4>1.3.1.2.9.6. Access to gonramp<a class="headerlink" href="#access-to-gonramp" title="Permalink to this headline">¶</a></h4>
<p>Start then access through browser:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ supervisord
# Check status
$ supervisorctl status
# Restart after changing configuration
$ supervisorctl restart galaxy:*
# Stop Galaxy
$ supervisorctl stop galaxy:*
Goto http://192.168.56.11/gonramp
</pre></div>
</div>
</div>
</div>
<div class="section" id="set-up-g-onramp">
<h3>1.3.1.2.10. 6. Set up G-OnRamp<a class="headerlink" href="#set-up-g-onramp" title="Permalink to this headline">¶</a></h3>
<div class="section" id="become-an-admin">
<h4>1.3.1.2.10.1. Become an Admin<a class="headerlink" href="#become-an-admin" title="Permalink to this headline">¶</a></h4>
<p>In order to install tools, you have to become administrator for your Galaxy instance. First start the server, go to <a class="reference external" href="http://192.168.56.11:8080/gonramp">http://192.168.56.11:8080/gonramp</a>, and register as a new user with your email address:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">username</span><span class="p">:</span> <span class="n">galaxyadmin</span><span class="nd">@gonramp</span><span class="o">.</span><span class="n">org</span>
<span class="n">public</span> <span class="n">name</span><span class="p">:</span> <span class="n">galaxyadmin</span>
<span class="n">password</span><span class="p">:</span> <span class="mi">12341234</span>
</pre></div>
</div>
<p>Go to galaxy folder and find a sub-folder called config. Add a new file named galaxy.ini in the config folder. You can copy the content of galaxy.ini.sample into galaxy.ini. In galaxy.ini, search for the line containing “admin_users”. Add your user email address to admin users. (Replace None to your email address). You can add multiple admin users by appending another email and separating them with a comma:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># this should be a comma-separated list of valid Galaxy users</span>
<span class="n">admin_users</span> <span class="o">=</span> <span class="n">galaxyadmin</span><span class="nd">@gonramp</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-conda">
<h4>1.3.1.2.10.2. Set up conda<a class="headerlink" href="#set-up-conda" title="Permalink to this headline">¶</a></h4>
<p>In galaxy.ini, uncomment and edit the following conda configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conda_ensure_channels</span> <span class="o">=</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">bioconda</span><span class="p">,</span><span class="n">iuc</span>
<span class="n">conda_auto_install</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">conda_auto_init</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="install-g-onramp-tools">
<h3>1.3.1.2.11. 7. Install G-OnRamp tools<a class="headerlink" href="#install-g-onramp-tools" title="Permalink to this headline">¶</a></h3>
<p>Go to Admin page, and click on Search Tool Shed. Click on the Tool Sheds to search and install. You can add all G-OnRamp tools in a separate panel section by adding a new tool panel section when you install the first tool and then add all the rest tools in the same panel.</p>
<div class="section" id="click-on-galaxy-main-tool-shed-to-install">
<h4>1.3.1.2.11.1. Click on Galaxy Main Tool Shed to install<a class="headerlink" href="#click-on-galaxy-main-tool-shed-to-install" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>ncbi_blast_plus (by devteam)</li>
<li>augustus</li>
<li>hisat2</li>
<li>stringtie</li>
<li>blastXmlToPsl (by yating-l)</li>
<li>trfbig (by yating-l)</li>
<li>pslToBed</li>
<li>bamtobigwig (by yating-l)</li>
<li>hubarchivecreator</li>
<li>multi_fasta_glimmer_hmm (by yating-l)</li>
<li>snap</li>
<li>psltobigpsl (by yating-l)</li>
<li>jbrowsearchivecreator</li>
<li>gbtofasta</li>
<li>regtools_junctions_extract (by yating-l)</li>
<li>rename_scaffolds</li>
<li>ucsc_blat</li>
<li>ucsc_pslcdnafilter</li>
<li>uscs_pslpostarget</li>
<li>uscs_pslcheck</li>
</ul>
</div>
<div class="section" id="tools-need-advanced-configuration">
<h4>1.3.1.2.11.2. Tools need advanced configuration<a class="headerlink" href="#tools-need-advanced-configuration" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>multi_fasta_glimmer_hmm</li>
</ol>
<p>Make a Dependencies folder in &#8220;/home/galaxy&#8221; and download Glimmer3 inside the folder by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ mkdir Dependencies
$ cd ~/Dependencies
$ wget ftp://ccb.jhu.edu/pub/software/glimmerhmm/GlimmerHMM-3.0.4.tar.gz
</pre></div>
</div>
<p>You need to use a trained organism by adding them as reference data in Galaxy. Add the glimmer_hmm_trained_dir data table to tool_data_table_conf.xml in $GALAXY_ROOT/config/:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!-- glimmer_hmm trained_dir --&gt;
&lt;table name=&quot;glimmer_hmm_trained_dir&quot; comment_char=&quot;#&quot;&gt;
  &lt;columns&gt;value, name, path&lt;/columns&gt;
  &lt;file path=&quot;tool-data/glimmer_hmm.loc&quot; /&gt;
&lt;/table&gt;
</pre></div>
</div>
<p>Configure the glimmer_hmm.loc file referencing your trained organism, in tool-data. Uncomment the species and add the path to trained_dir, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#TAB separated</span>
<span class="n">human</span>   <span class="n">Human</span>   <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">galaxy</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">/</span><span class="n">GlimmerHMM</span><span class="o">/</span><span class="n">trained_dir</span><span class="o">/</span><span class="n">human</span>
<span class="n">celegans</span>        <span class="n">Celegan</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">galaxy</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">/</span><span class="n">GlimmerHMM</span><span class="o">/</span><span class="n">trained_dir</span><span class="o">/</span><span class="n">celegans</span>
<span class="n">arabidopsis</span>     <span class="n">Arabidopsis</span>     <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">galaxy</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">/</span><span class="n">GlimmerHMM</span><span class="o">/</span><span class="n">trained_dir</span><span class="o">/</span><span class="n">arabidopsis</span>
<span class="n">rice</span>    <span class="n">Rice</span>    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">galaxy</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">/</span><span class="n">GlimmerHMM</span><span class="o">/</span><span class="n">trained_dir</span><span class="o">/</span><span class="n">rice</span>
<span class="n">zebrafish</span>       <span class="n">Zebrafish</span>       <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">galaxy</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">/</span><span class="n">GlimmerHMM</span><span class="o">/</span><span class="n">trained_dir</span><span class="o">/</span><span class="n">zebrafish</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>jbrowsearchivecreator</li>
</ol>
<p>Install JBrowse-1.12.1 at /var/www/html:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd /var/www/html
$ wget --trust-server-names http://jbrowse.org/wordpress/wp-content/plugins/download-monitor/download.php?id=105
$ sudo apt-get install unzip
$ sudo unzip JBrowse-1.12.1.zip
$ cd JBrowse-1.12.1
$ sudo ./setup.sh
# add a subdir to store hub data
$ sudo mkdir data
$ sudo chown -R galaxy:galaxy data
</pre></div>
</div>
<p>Add G-OnRamp plugins:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd JBrowse-1.12.1/plugins
$ sudo git clone https://github.com/Yating-L/JBrowse_plugins.git G-OnRamp_plugin
</pre></div>
</div>
<p>Add a plugins configuration variable in your jbrowse_conf.json file in the top-level JBrowse directory, and add an entry telling JBrowse where the plugin is. Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;G-OnRamp_plugin&#39;</span> <span class="p">]</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../installation.html">1. Installation of G-OnRamp</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installation.html#g-onramp-virtual-machine">1.1. G-OnRamp virtual machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#create-g-onramp-virtual-machine">1.2. Create G-OnRamp virtual machine</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../installation.html#create-g-onramp-virtual-machine-in-production-environment">1.3. Create G-OnRamp virtual machine in production environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#g-onramp-website">1.4. G-OnRamp website</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">2. Tutorials of G-OnRamp</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../installation.html">1. Installation of G-OnRamp</a><ul>
      <li>Previous: <a href="create_virtual_image.html" title="previous chapter">1.2.1. Create G-OnRamp Virtual Machine Image</a></li>
      <li>Next: <a href="../tutorials.html" title="next chapter">2. Tutorials of G-OnRamp</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/installation/create_virtual_image_production.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Yating Liu.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/installation/create_virtual_image_production.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>